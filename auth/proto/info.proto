syntax = "proto3";

package info;

service Info {
    rpc User (UserInfoRequest) returns (UserInfoReply);
    rpc Bucket (AllowedBucketReq) returns (AllowedBucketReply);
    rpc MessageForConsistency (stream BucketSync) returns (stream BucketSync);
}

message NotFound {
    string name = 1;
}

message NotEmpty {
    string name = 1;
}

message Error {
    oneof kind {
        NotFound not_found = 1;
        NotEmpty not_empty = 2;
    }
}

message RenameBucket {
    string from = 1;
    string to = 2;
}

message BucketSync {
    bytes operation_id = 4;
    oneof msg {
        string create_bucket = 1;
        string delete_bucket = 2;
        RenameBucket rename_bucket = 3;
        Error error = 5;
    }
}

message UserInfoRequest {
    bytes id = 1;
}

message UserInfoReply {
    string username = 1;
    Role role = 2;
    repeated string buckets = 3;
}

enum Role {
    SUPER_US = 0;
    ADMINISTRATOR = 1;
    OPERATOR = 2;
}

enum Permissions {
    PUT = 0;
    GET = 1;
    DELETE = 2;
}

message AllowedBucketReq {
    bytes id = 1;
    string name = 2;
    Permissions permissions = 3;
}

message AllowedBucketReply {
    bool allowed = 1;
}